<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}"></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"/>
</head>
<body>
<div class="progress">
    <div id="progress-bar" class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<button onclick="updateProgressBar()" class="btn btn-primary">Update Progress</button>
<div style="visibility: hidden" th:text="${myId}" id="clientID"></div>


<script>
    let id_ = document.getElementById('clientID').innerText;
    function updateProgressBar(progress) {
        let progressBar = document.getElementById('progress-bar');
        // let currentProgress = parseInt(progressBar.style.width) || 0;
        let newProgress = progress;
        progressBar.style.width = newProgress + '%';
        progressBar.setAttribute('aria-valuenow', newProgress);
        progressBar.innerText = newProgress + '%';
    }

    let id = setInterval(requestProgress, 100);// каждые 100 мсек выполняем запрос

    function requestProgress(){
        fetch('http://localhost:8081/progress' + id_) // отправляет гет запрос
            .then(function (response) { // обрабатываем респонс
                if (response.ok) {
                    return response.json(); // возвращаем объект в виде json
                } else
                {
                    throw new Error('Ошибкаааааа (((');
                }
            })
            .then(function (responseJson){ // ловим респонс в виде json
                updateProgressBar(responseJson['progress']);
                if (responseJson['success']) {
                    clearTimeout(id); //больше не отправляем запросы
                }
        })
        .catch(function (error) {
            console.log(error)
        })
    }

</script>
</body>
</html>